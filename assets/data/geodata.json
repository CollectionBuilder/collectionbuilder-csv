---
# generate geojson data for collection items with lat-longs
---
{%- assign items = site.data[site.metadata] | where_exp: 'item','item.objectid' | where_exp: 'item','item.latitude != nil and item.longitude != nil' -%}
{%- assign fields = site.data.theme.metadata-export-fields | split: "," -%}
{
    "type": "FeatureCollection",
    "features": [ 
        {% for item in items %}
        {
            "type":"Feature",
            "geometry":{
                "type":"Point",
                "coordinates":[{{ item.longitude }},{{ item.latitude }}]
            },            
            "properties":{
                {% for f in fields %}{% if item[f] %}{{ f | jsonify }}: {{ item[f] | jsonify }},{% endif %}
                {% endfor %}{% if item.image_thumb %}"object_thumb": "{{ item.image_thumb | absolute_url }}",{% endif %}
                "object_location": "{{ item.object_location | absolute_url }}",
                "reference_url": "{% if item.parentid %}{{ '/items/' | append: item.parentid | append: '.html#' | append: item.objectid | absolute_url }}{% else %}{{ '/items/' | append: item.objectid | append: '.html' | absolute_url }}{% endif %}"
            }
        }{% unless forloop.last %}, {% endunless %}{% endfor %}
    ]
}